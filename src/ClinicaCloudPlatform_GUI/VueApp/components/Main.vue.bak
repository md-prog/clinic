<template>
    <div class="wrapper">
        <header class="app-header navbar">
            <button class="navbar-toggler mobile-sidebar-toggler hidden-lg-up" type="button">☰</button>
            <a class="navbar-brand" href="#"></a>
            <ul class="nav navbar-nav hidden-md-down">
                <li class="nav-item">
                    <a class="nav-link navbar-toggler sidebar-toggler" href="#">☰</a>
                </li>
            </ul>
            <ul class="nav navbar-nav ml-auto">
                <li class="nav-item hidden-md-down">
                    <a class="nav-link navbar-toggler aside-menu-toggler" href="#">☰</a>
                </li>
            </ul>
            <nav class="nav navbar-nav ml-auto" role="navigation">
                <li class="nav-item hidden-md-down">
                    <a class="nav-link navbar-toggler aside-menu-toggler" href="#">☰</a>
                </li>
            </nav>
        </header>

        <div class="app-body">

            <!--left menu-->
            <aside class="sidebar">
                <section class="sidebar-nav">
                    <!-- search form (Optional) -->
                    <form v-on:submit.prevent class="sidebar-form">
                        <div class="form-group p-h mb-0">
                            <input type="text" name="search" id="search" class="search form-control" data-toggle="hideseek" placeholder="Search Menus" data-list=".sidebar-menu">
                            <span class="input-group-btn">
                                <button type="submit" name="search" id="search-btn" class="btn btn-flat">
                                    <i class="fa fa-search"></i>
                                </button>
                            </span>
                        </div>
                    </form>
                    <!-- Sidebar user panel (optional) -->
                    <!--<div class="user-panel">
                        <div class="pull-left image">

                        </div>
                        <div class="pull-left info">
                            <div><p class="white">{{ /*user.fullName*/ }}</p></div>
                            <a href="javascript:;"><i class="fa fa-circle text-success"></i> Online</a>
                        </div>
                    </div>-->
                    <!-- Sidebar Menu -->
                    <ul class="sidebar-menu nav">
                        <li class="pageLink" v-on:click="toggleMenu">
                            <router-link exact to="/">
                                <i class="icon-speedometer"></i> Dashboard <span class="badge badge-info">NEW</span>
                            </router-link>
                        </li>
                        <li class="divider"></li>
                        <li class="nav-title">
                            UI Elements
                        </li>
                        <!--<li class="active pageLink" v-on:click="toggleMenu"><router-link exact to="/"><i class="fa fa-desktop"></i><span class="page">Dashboard</span></router-link></li>-->
                        <li class="pageLink" v-on:click="toggleMenu"><router-link exact to="/tables"><i class="fa fa-table"></i><span class="page">Tables</span></router-link></li>

                        <li class="pageLink" v-on:click="toggleMenu"><router-link exact to="/tasks"><i class="fa fa-tasks"></i><span class="page">Tasks</span></router-link></li>
                        <li class="pageLink" v-on:click="toggleMenu"><router-link exact to="/setting"><i class="fa fa-cog"></i><span class="page">Settings</span></router-link></li>

                        <li class="pageLink" v-on:click="toggleMenu"><router-link exact to="/access"><i class="fa fa-book"></i><span class="page">Access</span></router-link></li>
                        <li class="pageLink" v-on:click="toggleMenu"><router-link exact to="/server"><i class="fa fa-hdd-o"></i><span class="page">Server</span></router-link></li>
                        <li class="pageLink" v-on:click="toggleMenu"><router-link exact to="/repos"><i class="fa fa-heart"></i><span class="page">Repos</span><small class="label pull-right bg-green">AJAX</small></router-link></li>

                        <li class="pageLink" v-on:click="toggleMenu"><router-link exact to="/login"><i class="fa fa-circle-o text-yellow"></i> <span class="page">Login</span></router-link></li>
                        <li class="pageLink" v-on:click="toggleMenu"><router-link exact to="/404"><i class="fa fa-circle-o text-red"></i> <span class="page">404</span></router-link></li>
                    </ul>
                    <!-- /.sidebar-menu -->
                </section>
                <!-- /.sidebar -->
            </aside>

            <!--right menu-->
            <aside class="aside-menu">
                <ul class="nav nav-tabs" role="tablist">
                    <!-- Messages-->
                    <li class="nav-item">
                        <a class="nav-link active" data-toggle="tab" href="#messages" role="tab">
                            <i class="icon-envelope-letter"></i>
                            <span class="label label-success">{{ user.customData.messages | count }}</span>
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" data-toggle="tab" href="#notifications" role="tab">
                            <i class="icon-bell"></i>
                            <span class="label label-success">{{ user.customData.notifications | count }}</span>
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" data-toggle="tab" href="#timeline" role="tab">
                            <i class="icon-list" />
                            <span class="label label-success">{{ user.customData.tasks | count }}</span>
                        </a>
                    </li>
                </ul>

                <!-- Main content -->
                <main class="main">
                    <div class="container-fluid pt-2">
                        <div class="animated fadeIn">
                            <!-- Content Header (Page header) -->
                            <section class="content-header">
                                <h1>
                                    {{$route.name.toUpperCase() }}
                                    <small>{{ $route.meta.description }}</small>
                                </h1>
                                <ol class="breadcrumb">
                                    <li><a href="javascript:;"><i class="fa fa-home"></i>Home</a></li>
                                    <li class="active">{{$route.name.toUpperCase() }}</li>
                                </ol>
                            </section>
                            <router-view></router-view>
                        </div>
                    </div>
                </main>

                <!--Right menu tabs-->
                <div class="tab-content">
                    <hr class="transparent mx-1 my-0">
                    <div class="tab-pane active" id="messages" role="tabpanel">
                        <ul class="callout callout-info m-0 py-1">
                            <div class="header">You have {{ user.customData.messages | count }} message(s)</div>
                            <div v-if="user.customData.messages.length > 0">
                                <!-- inner menu: contains the messages -->
                                <div class="float-right">
                                    <div>
                                        <!-- start message -->
                                        <a href="javascript:;">
                                            <!-- Message title and timestamp -->
                                            Support Team
                                            <i class="icon-clock"></i> 5 mins

                                            <!-- The message -->
                                            <p>Why not consider this a test message?</p>
                                        </a>
                                    </div>
                                    <!-- end message -->
                                </div>
                                <!-- /.menu -->
                            </div>
                        </ul>
                    </div>
                    <div class="tab-pane active" id="notifications" role="tabpanel">
                        <div class="tab-pane active" id="notifications" role="tabpanel">
                            <div v-if="user.customData.notifications.length > 0">
                                <div class="callout callout-success m-0 py-1">
                                    <div class="header">You have {{ user.customData.notifications | count }} notification(s)</div>
                                    <div class="float-left">
                                        <div v-for="notification in user.customData.notifications">
                                            <a href="javascript:;">
                                                <i class="fa fa-users"></i> {{notification.message}}
                                            </a>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="tab-pane" id="tasks" role="tabpanel">
                        <div v-if="user.customData.tasks.length > 0">
                            <div class="callout callout-info m-0 py-1">
                                <div class="header">You have {{ user.customData.tasks | count }} tasks(s)</div>
                                <div class="callout m-0 py-h text-muted text-center bg-faded text-uppercase">
                                    <small>
                                        <b>Today</b>
                                    </small>
                                </div>
                                <div v-if="user.customData.messages.length > 0">
                                    <!-- inner menu: contains the messages -->
                                    <div>
                                        Meeting with
                                        <strong>Lucas</strong>
                                    </div>
                                    <small class="text-muted mr-1"><i class="icon-calendar"></i>&nbsp; 1 - 3pm</small>
                                    <small class="text-muted"><i class="icon-location-pin"></i>&nbsp; Palo Alto, CA</small>
                                    <!-- /.menu -->
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </aside>
        </div>


        <!-- Main Footer -->
        <footer class="app-footer">
            <strong>Copyright &copy; {{year}} <a href="javascript:;">Ars Clinica</a>.</strong> All rights reserved.
        </footer>
    </div>
</template>

<script>
    import { mapGetters, mapActions } from 'vuex';
    require('hideseek')

    module.exports = {
        computed: {
              ...mapGetters('user', ['user']),
        store: function () {
            return this.$parent.$store
        },
        state: function () {
            return this.store.state
        }
    },
    methods: {
        ...mapActions('user', ['getUser', 'updateCustomData']),
        changeloading: function () {
            this.store.dispatch('TOGGLE_SEARCHING')
        },
        toggleMenu: function (event) {
            // remove active from li
            window.$('li.pageLink').removeClass('active')

            // Add it to the item that was clicked
            event.toElement.parentElement.className = 'pageLink active'
        }
    },
    beforeMount() {
        this.$parent.$store.dispatch('user/getUser')
    },
    }
</script>

<style>
    .user-panel {
        height: 4em;
    }

    hr.visible-xs-block {
        width: 100%;
        background-color: rgba(0, 0, 0, 0.17);
        height: 1px;
        border-color: transparent;
    }
</style>
